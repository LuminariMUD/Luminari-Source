# Considerations

> Institutional memory for AI assistants. Updated between phases via /carryforward.
> **Line budget**: 600 max | **Last updated**: Phase 01 (2025-12-30)

---

## Active Concerns

Items requiring attention in upcoming phases. Review before each session.

### Technical Debt
<!-- Max 5 items -->

1. **Duplicate struct definitions in vessels.h** - greyhawk_ship_slot, greyhawk_ship_crew, greyhawk_ship_data defined twice (lines 321-405 and 498-612). Needs consolidation.
2. **VESSEL_STATE constants duplicated** - VESSEL_STATE_TRAVELING/COMBAT/DAMAGED and VESSEL_SIZE_* defined twice (lines 50-58 and 89-97).
3. **Room templates hard-coded** - vessels_rooms.c uses 10 hard-coded templates instead of querying ship_room_templates DB table.
4. **Interior movement unimplemented** - do_move_ship_interior(), get_ship_exit(), is_passage_blocked() declared but not implemented.

### External Dependencies
<!-- Max 5 items -->

1. **MySQL/MariaDB required** - Server will not function without database connection.
2. **Wilderness system required** - Vessel navigation depends on wilderness coordinate system being operational.
3. **Zone 213 test area** - Test zone must be configured for vessel testing.

### Performance / Security
<!-- Max 5 items -->

1. **Max 500 concurrent vessels validated** - Stress test passed at 100/250/500 vessels.
2. **Memory target achieved: 1016 bytes/vessel** - Within <1KB target.
3. **VNUM range 30000-40019 reserved** - Do not use for builder zones.

### Architecture
<!-- Max 5 items -->

1. **Vessel movement fails silently** - Destination wilderness coordinate has no allocated room; must implement dynamic room allocation using find_available_wilderness_room() + assign_wilderness_room() pattern.
2. **Per-vessel type mapping missing** - Currently hardcoded to VESSEL_TYPE_SAILING_SHIP placeholder.
3. **Phase 2 commands not registered** - dock, undock, board_hostile, look_outside, ship_rooms need adding to interpreter.c.

---

## Lessons Learned

Proven patterns and anti-patterns. Reference during implementation.

### What Worked
<!-- Max 15 items -->

1. **Auto-create DB tables at startup** - Schema matches runtime code exactly.
2. **Greyhawk system as foundation** - Most complete existing implementation.
3. **Wilderness coordinate system** - Provides solid X/Y/Z navigation framework.
4. **Standalone unit test files** - Self-contained tests without server dependencies.
5. **Incremental session approach** - Each session builds cleanly on prior work.
6. **Valgrind with suppression file** - Filters CuTest framework leaks, validates real code.
7. **Memory-efficient autopilot struct** - 48 bytes per vessel enables scaling.
8. **In-memory cache for waypoints/routes** - Fast lookups without DB round-trips.

### What to Avoid
<!-- Max 10 items -->

1. **Don't use C99/C11 features** - This is ANSI C90/C89 codebase.
2. **Don't hardcode VNUMs** - Use #defines or configuration.
3. **Don't skip NULL checks** - Critical in C code.
4. **Don't commit environment-specific files** - campaign.h, mud_options.h, vnums.h.

### Tool/Library Notes
<!-- Max 5 items -->

1. **CuTest for unit testing** - Located in unittests/CuTest/.
2. **Valgrind for memory leak detection** - Run tests with --leak-check=full.

---

## Resolved

Recently closed items (buffer - rotates out after 2 phases).

| Phase | Item | Resolution |
|-------|------|------------|
| P01 | Max 500 vessels target | Validated via stress test (100/250/500) |
| P01 | Memory <1KB per vessel | Achieved: 1016 bytes/vessel |
| P01 | 84 unit tests for automation | All passing, Valgrind clean |

---

*Auto-generated by /initspec. Updated by /carryforward between phases.*
